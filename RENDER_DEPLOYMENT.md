# Deploy PG Rental System to Render

This guide will help you deploy the PG Rental System to Render with separate backend and frontend services.

## Prerequisites
- GitHub repository with your code
- Render account (free tier works)

## Step 1: Push Updates to GitHub

First, commit and push all the deployment changes:

```bash
git add .
git commit -m "Add Render deployment configuration"
git push origin main
```

## Step 2: Deploy Backend

### 2.1 Create Backend Service

1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click "New +" â†’ "Web Service"
3. Connect your GitHub repository
4. Configure the service:
   - **Name**: `pg-rental-backend`
   - **Root Directory**: `backend`
   - **Runtime**: Node
   - **Build Command**: `npm install && node scripts/init-production-db.js`
   - **Start Command**: `npm start`

### 2.2 Add Environment Variables

Click "Environment" and add:

```
NODE_ENV=production
JWT_SECRET=<click-generate-to-create-secure-key>
DB_PATH=/var/data/pg_rental.db
FRONTEND_URL=https://pg-rental-frontend.onrender.com
PORT=10000
```

### 2.3 Add Persistent Disk

1. Click "Disks" in the left sidebar
2. Add a disk:
   - **Name**: `sqlite-data`
   - **Mount Path**: `/var/data`
   - **Size**: 1 GB

### 2.4 Deploy Backend

Click "Create Web Service" and wait for deployment (5-10 minutes).

Note your backend URL: `https://pg-rental-backend.onrender.com`

## Step 3: Deploy Frontend

### 3.1 Create Frontend Service

1. Go back to Render Dashboard
2. Click "New +" â†’ "Static Site"
3. Connect the same GitHub repository
4. Configure the service:
   - **Name**: `pg-rental-frontend`
   - **Root Directory**: `frontend`
   - **Build Command**: `npm install && npm run build`
   - **Publish Directory**: `build`

### 3.2 Add Environment Variables

Add the following environment variable:

```
REACT_APP_API_URL=https://pg-rental-backend.onrender.com/api
```

(Replace with your actual backend URL from Step 2.4)

### 3.3 Add Redirect Rules

In the "Redirects/Rewrites" section, add:
- **Source**: `/*`
- **Destination**: `/index.html`
- **Type**: Rewrite

### 3.4 Deploy Frontend

Click "Create Static Site" and wait for deployment.

## Step 4: Update CORS Settings

After both services are deployed:

1. Go to your backend service on Render
2. Update the `FRONTEND_URL` environment variable with your actual frontend URL
3. The backend will automatically redeploy

## Step 5: Verify Deployment

1. Visit your frontend URL: `https://pg-rental-frontend.onrender.com`
2. The application should load with room listings
3. Test the booking form and payment features

## Troubleshooting

### Database Issues
If rooms don't appear:
1. Check backend logs in Render dashboard
2. Manually trigger build command: `npm run build`
3. Verify disk is mounted at `/var/data`

### CORS Errors
1. Ensure `FRONTEND_URL` in backend matches your frontend URL exactly
2. Check backend logs for CORS configuration

### API Connection Issues
1. Verify `REACT_APP_API_URL` in frontend points to backend URL
2. Ensure backend is running (check Render dashboard)

## Environment Variables Summary

### Backend (.env)
```
NODE_ENV=production
JWT_SECRET=<auto-generated>
DB_PATH=/var/data/pg_rental.db
FRONTEND_URL=<your-frontend-url>
PORT=10000
```

### Frontend (.env)
```
REACT_APP_API_URL=<your-backend-url>/api
```

## Important Notes

1. **Free Tier Limitations**:
   - Services spin down after 15 minutes of inactivity
   - First request after spin-down takes 30-50 seconds
   - 750 hours/month of free runtime

2. **Database Persistence**:
   - SQLite database is stored on persistent disk
   - Data survives redeploys and restarts
   - Regular backups recommended for production

3. **Scaling**:
   - For production, consider upgrading to paid tier
   - Switch to PostgreSQL for better performance
   - Add Redis for session management

## Custom Domain (Optional)

To add a custom domain:
1. Go to Settings â†’ Custom Domains
2. Add your domain
3. Update DNS records as instructed
4. Enable Auto-SSL

## Monitoring

1. View logs in Render dashboard
2. Set up health checks for uptime monitoring
3. Configure alerts for errors

Your PG Rental System is now live on Render! ðŸŽ‰